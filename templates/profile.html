{% extends "base.html" %}

{% block content %}
<div class="dashboard-container">
    <div class="page-header">
        <h1><i class="fas fa-user-circle"></i> Mon Profil</h1>
    </div>
    
    <div class="profile-grid">
        <div class="profile-card">
            <div class="card-header">
                <i class="fas fa-user"></i>
                <h3>Informations personnelles</h3>
            </div>
            <div class="card-body">
                <div class="profile-info">
                    <div class="info-row">
                        <span class="info-label">Nom d'utilisateur</span>
                        <span class="info-value">{{ current_user.username }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Email</span>
                        <span class="info-value">{{ current_user.email }}</span>
                    </div>
                    <div class="info-row">
                        <span class="info-label">Membre depuis</span>
                        <span class="info-value">{{ current_user.created_at.strftime('%d/%m/%Y') }}</span>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="profile-card referral-card">
            <div class="card-header">
                <i class="fas fa-users"></i>
                <h3>Parrainage</h3>
            </div>
            <div class="card-body">
                <div class="referral-code-section">
                    <p class="referral-label">Votre code de parrainage</p>
                    <div class="referral-code-box">
                        <span class="referral-code" id="referralCode">{{ current_user.referral_code }}</span>
                        <button class="btn btn-sm btn-copy" onclick="copyReferralCode()">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                
                <div class="referral-link-section">
                    <p class="referral-label">Lien de parrainage</p>
                    <div class="referral-link-box">
                        <input type="text" readonly id="referralLink" value="{{ referral_link }}" class="referral-link-input">
                        <button class="btn btn-sm btn-copy" onclick="copyReferralLink()">
                            <i class="fas fa-copy"></i>
                        </button>
                    </div>
                </div>
                
                <div class="referral-stats">
                    <div class="referral-stat">
                        <span class="stat-value">{{ referral_count }}</span>
                        <span class="stat-label">Filleuls</span>
                    </div>
                    <div class="referral-stat">
                        <span class="stat-value">{{ "%.2f"|format(current_user.referral_bonus_earned or 0) }}$</span>
                        <span class="stat-label">Bonus gagnés</span>
                    </div>
                </div>
                
                <div class="referral-info">
                    <i class="fas fa-info-circle"></i>
                    <p>Gagnez {{ referral_bonus }}$ pour chaque filleul qui fait son premier dépot!</p>
                </div>
            </div>
        </div>
        
        <div class="profile-card">
            <div class="card-header">
                <i class="fas fa-lock"></i>
                <h3>Changer le mot de passe</h3>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('change_password') }}" class="password-form">
                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                    <div class="form-group">
                        <label for="current_password">Mot de passe actuel</label>
                        <input type="password" id="current_password" name="current_password" required>
                    </div>
                    <div class="form-group">
                        <label for="new_password">Nouveau mot de passe</label>
                        <input type="password" id="new_password" name="new_password" required minlength="6">
                    </div>
                    <div class="form-group">
                        <label for="confirm_password">Confirmer le nouveau mot de passe</label>
                        <input type="password" id="confirm_password" name="confirm_password" required minlength="6">
                    </div>
                    <button type="submit" class="btn btn-primary">Mettre a jour</button>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
.profile-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
    gap: 1.5rem;
    max-width: 1200px;
    margin: 0 auto;
}

.profile-card {
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0.05) 100%);
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.1);
    overflow: hidden;
}

.card-header {
    background: rgba(0,0,0,0.2);
    padding: 1rem 1.5rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    border-bottom: 1px solid rgba(255,255,255,0.1);
}

.card-header i {
    color: var(--primary);
    font-size: 1.25rem;
}

.card-header h3 {
    margin: 0;
    font-size: 1.1rem;
    color: #fff;
}

.card-body {
    padding: 1.5rem;
}

.profile-info {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.info-row {
    display: flex;
    justify-content: space-between;
    padding: 0.75rem;
    background: rgba(0,0,0,0.2);
    border-radius: 8px;
}

.info-label {
    color: rgba(255,255,255,0.6);
}

.info-value {
    color: #fff;
    font-weight: 500;
}

.referral-code-section,
.referral-link-section {
    margin-bottom: 1.5rem;
}

.referral-label {
    color: rgba(255,255,255,0.7);
    margin-bottom: 0.5rem;
    font-size: 0.9rem;
}

.referral-code-box {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    background: rgba(0,0,0,0.3);
    padding: 0.75rem 1rem;
    border-radius: 8px;
    border: 1px solid rgba(255,255,255,0.1);
}

.referral-code {
    font-family: monospace;
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--primary);
    letter-spacing: 2px;
    flex: 1;
}

.referral-link-box {
    display: flex;
    gap: 0.5rem;
}

.referral-link-input {
    flex: 1;
    background: rgba(0,0,0,0.3);
    border: 1px solid rgba(255,255,255,0.1);
    padding: 0.75rem 1rem;
    border-radius: 8px;
    color: #fff;
    font-size: 0.85rem;
}

.btn-copy {
    background: var(--primary);
    color: #000;
    border: none;
    padding: 0.5rem 0.75rem;
    border-radius: 6px;
    cursor: pointer;
    transition: all 0.2s;
}

.btn-copy:hover {
    background: var(--primary-dark);
    transform: scale(1.05);
}

.referral-stats {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.referral-stat {
    background: rgba(0,0,0,0.3);
    padding: 1rem;
    border-radius: 8px;
    text-align: center;
}

.stat-value {
    display: block;
    font-size: 1.5rem;
    font-weight: bold;
    color: var(--primary);
}

.stat-label {
    color: rgba(255,255,255,0.6);
    font-size: 0.85rem;
}

.referral-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
    background: rgba(46, 213, 115, 0.1);
    border-radius: 8px;
    border: 1px solid rgba(46, 213, 115, 0.3);
}

.referral-info i {
    color: var(--primary);
    font-size: 1.25rem;
}

.referral-info p {
    margin: 0;
    color: rgba(255,255,255,0.8);
    font-size: 0.9rem;
}

.password-form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
}

.password-form .form-group {
    margin-bottom: 0;
}

.password-form label {
    display: block;
    margin-bottom: 0.5rem;
    color: rgba(255,255,255,0.7);
}

.password-form input {
    width: 100%;
    padding: 0.75rem 1rem;
    background: rgba(0,0,0,0.3);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 8px;
    color: #fff;
}

.password-form input:focus {
    outline: none;
    border-color: var(--primary);
}

@media (max-width: 768px) {
    .profile-grid {
        grid-template-columns: 1fr;
    }
}
</style>

<script>
function copyReferralCode() {
    const code = document.getElementById('referralCode').textContent;
    navigator.clipboard.writeText(code).then(() => {
        showToast('Code copie!');
    });
}

function copyReferralLink() {
    const link = document.getElementById('referralLink').value;
    navigator.clipboard.writeText(link).then(() => {
        showToast('Lien copie!');
    });
}

function showToast(message) {
    const toast = document.createElement('div');
    toast.className = 'toast-notification';
    toast.innerHTML = '<i class="fas fa-check"></i> ' + message;
    toast.style.cssText = `
        position: fixed;
        bottom: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: var(--primary);
        color: #000;
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-weight: 500;
        z-index: 9999;
        animation: fadeInUp 0.3s ease;
    `;
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 2000);
}
</script>
{% endblock %}
