{% extends "base.html" %}

{% block content %}
<div class="deposit-container">
    <h1>G√©rer votre argent</h1>
    
    <div class="crypto-deposit-section">
        <div class="crypto-card">
            <div class="crypto-header">
                <img src="https://cryptologos.cc/logos/bnb-bnb-logo.png" alt="BNB" class="crypto-logo">
                <div>
                    <h2>D√©p√¥t en BNB (BEP20)</h2>
                    <span class="network-badge">Binance Smart Chain</span>
                </div>
            </div>
            <div class="crypto-address-box">
                <label>Adresse de d√©p√¥t</label>
                <div class="address-container">
                    <code id="wallet-address">0x4dc2eac23fa51001d5acc94889177ec066cc389c</code>
                    <button type="button" class="copy-btn" onclick="copyAddress()">
                        <span id="copy-text">Copier</span>
                    </button>
                </div>
            </div>
            <div class="crypto-info">
                <div class="info-item">
                    <span class="info-icon">üí∞</span>
                    <span>Minimum: <strong>200 USDT</strong></span>
                </div>
                <div class="info-item">
                    <span class="info-icon">‚ö°</span>
                    <span>R√©seau: <strong>BEP20 (BSC)</strong></span>
                </div>
                <div class="info-item warning">
                    <span class="info-icon">‚ö†Ô∏è</span>
                    <span>Envoyez uniquement des BNB ou USDT sur le r√©seau BEP20</span>
                </div>
            </div>
        </div>
    </div>
    
    <div class="deposit-request-section">
        <div class="deposit-card">
            <h2><i class="fas fa-paper-plane"></i> Soumettre une demande de d√©p√¥t</h2>
            <p class="deposit-info">Apr√®s avoir envoy√© vos cryptos, soumettez votre demande pour validation</p>
            <form method="POST" action="{{ url_for('request_deposit') }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="form-group">
                    <label for="amount">Montant envoy√© (USDT)</label>
                    <input type="number" id="request-amount" name="amount" step="0.01" min="200" required placeholder="200.00">
                </div>
                <div class="form-group">
                    <label for="tx_hash">Hash de transaction (optionnel)</label>
                    <input type="text" id="tx_hash" name="tx_hash" placeholder="0x...">
                    <small class="form-hint">Le hash de votre transaction blockchain pour v√©rification</small>
                </div>
                <button type="submit" class="btn btn-primary btn-full">
                    <i class="fas fa-paper-plane"></i> Soumettre la demande
                </button>
            </form>
        </div>
    </div>
    
    {% if transactions %}
    <div class="pending-transactions-section">
        <h3><i class="fas fa-clock"></i> Vos demandes r√©centes</h3>
        <div class="transactions-list">
            {% for tx in transactions %}
            <div class="transaction-item status-{{ tx.status }}">
                <div class="tx-info">
                    <span class="tx-type">{{ 'D√©p√¥t' if tx.type == 'deposit' else 'Retrait' }}</span>
                    <span class="tx-amount">{{ "%.2f"|format(tx.amount) }}$</span>
                </div>
                <div class="tx-status">
                    {% if tx.status == 'pending' %}
                        <span class="badge badge-warning"><i class="fas fa-clock"></i> En attente</span>
                    {% elif tx.status == 'approved' %}
                        <span class="badge badge-success"><i class="fas fa-check"></i> Approuv√©e</span>
                    {% else %}
                        <span class="badge badge-danger"><i class="fas fa-times"></i> Rejet√©e</span>
                    {% endif %}
                </div>
                <div class="tx-date">{{ tx.created_at.strftime('%d/%m/%Y %H:%M') }}</div>
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <div class="deposit-grid">
        <div class="deposit-card">
            <h2>Votre solde</h2>
            <p class="current-value">{{ "%.2f"|format(current_user.balance) }}$</p>
            <p class="deposit-info">Solde disponible apr√®s confirmation du d√©p√¥t crypto</p>
        </div>
        
        <div class="deposit-card">
            <h2>Activer les qu√™tes</h2>
            <p class="current-value">D√©p√¥t actuel: {{ "%.2f"|format(current_user.deposit) }}$</p>
            <p class="deposit-info">Minimum requis: <strong>200$</strong></p>
            <form method="POST" action="{{ url_for('deposit') }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="form-group">
                    <label for="amount">Montant √† d√©poser (depuis votre solde)</label>
                    <input type="number" id="deposit-amount" name="amount" step="0.01" min="200" max="{{ current_user.balance }}" required placeholder="200.00">
                </div>
                <button type="submit" class="btn btn-primary btn-full" {% if current_user.balance < 200 %}disabled{% endif %}>
                    Activer les qu√™tes
                </button>
            </form>
            {% if current_user.balance < 200 %}
            <p class="deposit-warning">Solde minimum de 200$ requis</p>
            {% endif %}
        </div>
    </div>
    
    <div class="deposit-info-section">
        <h3>Comment √ßa fonctionne?</h3>
        <div class="steps-grid">
            <div class="step">
                <div class="step-number">1</div>
                <h4>Envoyez vos cryptos</h4>
                <p>Envoyez minimum 200$ en BNB ou USDT √† l'adresse ci-dessus</p>
            </div>
            <div class="step">
                <div class="step-number">2</div>
                <h4>Confirmation</h4>
                <p>Votre solde sera cr√©dit√© apr√®s confirmation sur la blockchain</p>
            </div>
            <div class="step">
                <div class="step-number">3</div>
                <h4>Activez les qu√™tes</h4>
                <p>D√©posez depuis votre solde pour d√©bloquer les qu√™tes</p>
            </div>
            <div class="step">
                <div class="step-number">4</div>
                <h4>Gagnez 50%</h4>
                <p>Chaque qu√™te compl√©t√©e rapporte 50% de votre d√©p√¥t!</p>
            </div>
        </div>
    </div>
    
    <a href="{{ url_for('dashboard') }}" class="btn btn-outline">Retour aux qu√™tes</a>
</div>

<script>
function copyAddress() {
    const address = document.getElementById('wallet-address').textContent;
    navigator.clipboard.writeText(address).then(() => {
        const copyText = document.getElementById('copy-text');
        copyText.textContent = 'Copi√©!';
        setTimeout(() => {
            copyText.textContent = 'Copier';
        }, 2000);
    });
}
</script>
{% endblock %}
